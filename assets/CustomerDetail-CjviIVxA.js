import{y as v,E as A,r as b,j as e,k as w,f as I,F as R,h as z,c as T,q as B,t as f,e as j,B as D,R as N,C as d,s as L}from"./index-BBZVF_XH.js";import{F as _}from"./FeatureHeader-DpyJK2EI.js";import{H as $}from"./HookForm-Lmu3z8lE.js";import{I as u}from"./Input-DNZQAGF7.js";import{a as U,b as O,c as G,d as P,C as H}from"./index.esm-16HUKa1g.js";import{r as X}from"./upload02-icon-CvQZ4Da_.js";import{E as M}from"./ErrorMessage-BmJuqbm7.js";import{b as c,A as S}from"./labels--gJQxQlO.js";import{C as E}from"./FormSelect-CRrV35Dd.js";import"./FormCheck-B5v7tI3p.js";/**
 * @license hugeicons-react v0.1.3
 *
 * See the LICENSE file in the root directory of this source tree.
 */const Z=v("Cancel01Icon",[["path",{d:"M19 5L5 19M5 5L19 19",stroke:"currentColor",key:"k0"}]]);/**
 * @license hugeicons-react v0.1.3
 *
 * See the LICENSE file in the root directory of this source tree.
 */const q=v("DocumentValidationIcon",[["path",{d:"M14.9805 7.01562C14.9805 7.01562 15.4805 7.51562 15.9805 8.51562C15.9805 8.51562 17.5687 6.01562 18.9805 5.51562",stroke:"currentColor",key:"k0"}],["path",{d:"M9.99485 2.02141C7.49638 1.91562 5.56612 2.20344 5.56612 2.20344C4.34727 2.29059 2.01146 2.97391 2.01148 6.9646C2.0115 10.9214 1.98564 15.7993 2.01148 17.744C2.01148 18.932 2.7471 21.7034 5.29326 21.8519C8.3881 22.0324 13.9627 22.0708 16.5205 21.8519C17.2051 21.8133 19.4846 21.2758 19.7731 18.7957C20.072 16.2264 20.0125 14.4407 20.0125 14.0157",stroke:"currentColor",key:"k1"}],["path",{d:"M21.9999 7.01562C21.9999 9.77705 19.7591 12.0156 16.995 12.0156C14.231 12.0156 11.9902 9.77705 11.9902 7.01562C11.9902 4.2542 14.231 2.01562 16.995 2.01562C19.7591 2.01562 21.9999 4.2542 21.9999 7.01562Z",stroke:"currentColor",key:"k2"}],["path",{d:"M6.98047 13.0156H10.9805",stroke:"currentColor",key:"k3"}],["path",{d:"M6.98047 17.0156H14.9805",stroke:"currentColor",key:"k4"}]]),V=s=>{const n=["Bytes","KB","MB","GB"];if(s===0)return"0 bytes";let p=0;for(;s>=1e3&&p<n.length-1;)s/=1e3,p++;return`${(s==null?void 0:s.toFixed(2))||0} ${n[p]}`},K=s=>{const n=s.replaceAll(/[0-9\.]+/g,"").trim(),r=s.replaceAll(/[a-zA-Z]+/g,"").trim();return{unit:n,size:r}},Y=1048576,y=s=>{const n=s/Y,r=K(A);return n.toFixed(2)>Number(r.size).toFixed(2)},J=()=>{const{control:s,setError:n,clearErrors:r}=U(),{fields:p,append:g,remove:l}=O({control:s,name:"documents",keyName:"id"}),x=b.useRef(null),k=()=>{x.current.click()},a=o=>{const t=Array.from(o.target.files||[]),h=t.some(i=>i.size===0),m=t.some(i=>y(i.size));if(h?n("documents",{type:"manual",message:"File(s) should not be empty"}):m?n("documents",{type:"manual",message:`File(s) size should be under ${A}`}):r("documents"),t.length>0){const i=t.map(C=>({file:C}));g(i)}x.current.value=""};return e.jsxs(G,{children:[e.jsx(P,{children:c.DOCUMENTS}),e.jsx(w,{type:"file",hidden:!0,className:"file-uploader-input",ref:x,multiple:!0,onChange:a}),e.jsxs(E,{children:[e.jsx(E.Header,{className:"p-0",children:e.jsxs("div",{style:{backgroundColor:"#CCC !important"},className:"p-4 rounded bg-light border border-2 text-center cursor-pointer",onClick:k,children:[e.jsx(X,{size:34,className:"me-3"}),e.jsx("p",{className:"mb-0 mt-1",style:{fontSize:".90rem"},children:"Click to browse or Drag and drop."})]})}),e.jsx(E.Body,{className:"p-0",children:e.jsx(I,{variant:"flush",children:p.map((o,t)=>e.jsx(H,{control:s,name:`${c.DOCUMENTS}.${t}`,render:()=>{var h,m,i,C;return e.jsx(I.Item,{className:"mt-2 border rounded-3 p-3 px-4",children:e.jsxs(R,{className:"justify-content-between",children:[e.jsx(q,{className:"me-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-truncate",children:((h=o.file)==null?void 0:h.name)||o.name}),e.jsx("small",{className:"text-secondary",children:V(((m=o.file)==null?void 0:m.size)||o.size)})]}),e.jsx("div",{className:"me-5",children:"12/2/2024"}),e.jsx(Z,{className:"cursor-pointer",onClick:()=>l(t)}),((i=o.file)==null?void 0:i.size)===0&&e.jsx(M,{errorMessage:"File is empty"}),y(((C=o.file)==null?void 0:C.size)||o.size)&&e.jsx(M,{errorMessage:`File size should be under ${A}`})]})},t)}},o.id))})})]})]})},Q=/^[0-9]{10}$/,W=/^[^\s@]+@[^\s@]+\.com$/,ee=/^[0-9]{6}$/,de=()=>{const{billDetails:s,setBillDetails:n}=z(),[r,p]=b.useState(),g=T(),{customerId:l}=B();b.useEffect(()=>{l!="new"&&x(l)},[l]);const x=async a=>{const t=(await f(j.get(`/cng/customers/${a}`))).data,m=(await f(j.get(`/cng/customers/${a}/documents`))).data._embedded.documents;t.documents=m,p(t)},k=async a=>{const{documents:o=[],...t}=a;l==="new"&&await f(L.post("/register",{emailAddress:t.emailAddress,role:"Customer",fullName:t.fullName,phoneNumber:t.contactNumber}));const m=(await f(j({url:r?`/cng/customers/${l}`:"/cng/customers",method:r?"PUT":"POST",data:t}))).data,i=m.id;m.accountNumber;for(const C of o)if(C.file){const F=new FormData;F.append("file",C.file),F.append("customerId",i),await f(j.post("/cng/documents",F))}n({...s,customerId:i}),g.back()};return e.jsx("div",{children:e.jsxs($,{onSubmit:k,defaultValues:r,children:[e.jsx(_,{title:"Create Customer",className:"justify-content-between",breadcrumbs:[{title:"Bill",path:"/bills",hidden:!s},{title:`${s!=null&&s.billId?"#"+(s==null?void 0:s.billId):"New"}`,path:`/bills/${(s==null?void 0:s.billId)||"new"}`,hidden:!s},{title:"Customer",path:"/customers"},{title:l==="new"?"New":r==null?void 0:r.fullName}],children:e.jsx(D,{variant:"primary",type:"submit",children:l!=="new"?S.UPDATE:S.CREATE})}),e.jsxs(E,{body:!0,children:[e.jsxs(N,{children:[e.jsx(u,{as:d,required:!1,field:{title:c.ACCOUNT_NUMBER,state:"accountNumber"},control:{disabled:!0}}),e.jsx(u,{as:d,field:{title:c.FULL_NAME,state:"fullName"}})]}),e.jsxs(N,{children:[e.jsx(u,{as:d,field:{title:c.EMAIL_ADDRESS,state:"emailAddress"},validate:{format:a=>a.match(W)?void 0:"Invalid Email address"}}),e.jsx(u,{as:d,field:{title:c.CONTACT_NUMBER,state:"contactNumber"},validate:{format:a=>a.match(Q)?void 0:"Must be 10 digits long"}})]}),e.jsxs(N,{children:[e.jsx(u,{as:d,field:{title:c.STATE,state:"state"}}),e.jsx(u,{as:d,field:{title:c.CITY,state:"city"}})]}),e.jsxs(N,{children:[e.jsx(u,{as:d,field:{title:c.BILLING_ADDRESS,state:"billingAddress"}}),e.jsx(u,{as:d,field:{title:c.PINCODE,state:"pincode"},validate:{pinCodeFormat:a=>a.toString().match(ee)?void 0:"Must be 6 digits long"}})]}),e.jsx(J,{})]})]})})};export{de as default};
